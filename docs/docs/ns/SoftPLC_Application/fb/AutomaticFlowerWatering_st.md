# PLC Garden Controller | [MAIN] | [NAMESPACES] | [METRICS] | [BACK]  

## Documentation for Function block AutomaticFlowerWatering  

```pascal
INTERFACE
    VAR_INPUT
        instructions : ARRAY[0..24, 0..1] OF INT; (*Instructions to follow*)
        xAxis : INT; (*Actual position of the X axis servo*)
        yAxis : INT; (*Actual position of the Y axis servo*)
    END_VAR
    VAR_OUTPUT
        servoX_CW : BOOL; (*Command to turn X axis servo clock wise*)
        servoX_CCW : BOOL; (*Command to turn X axis servo counter clock wise*)
        servoY_CW : BOOL; (*Command to turn Y axis servo clock wise*)
        servoY_CCW : BOOL; (*Command to turn Y axis servo counter clock wise*)
        waterTankOpenCmd : BOOL; (*Command to the platform to open the water valve*)
    END_VAR
    VAR
        i : UINT; (*Iterator variable*)
        vXAxisCmd : INT; (*Next X axis target*)
        vYAxisCmd : INT; (*Next Y axis target*)
        vPlatformAtTarget : BOOL; (*Flag for reaching the target*)
        WateringTimer : TON; (*Timer for controlling the valve being open*)
    END_VAR
END_INTERFACE
FUNCTION_BLOCK AutomaticFlowerWatering:
    (* Parse the instruction to get new x and y targets *)
    vXAxisCmd := instructions[i,0];
    vYAxisCmd := instructions[i,1];
    	
    (*Check if the platform is at the target*)
    vPlatformAtTarget := xAxis = vXAxisCmd AND yAxis = vYAxisCmd;

    IF vPlatformAtTarget THEN
    	(*Start watering for 1 second*)
    	WateringTimer(IN:=TRUE, PT:=T#1S);
    	waterTankOpenCmd := TRUE;
    	
    	(*If watering is finished, close valve and go to next flower*)
    	IF WateringTimer.Q THEN
    		WateringTimer(IN := FALSE);
    		waterTankOpenCmd:= FALSE;
    		i:= i + 1;
    	END_IF
    END_IF

    (*If we traversed all instructions, go to first instruction*)
    IF i = 25 THEN
    	i := 0;
    END_IF

    (* Actual motor movement algorithm *)
    IF vXAxisCmd > xAxis THEN
    	servoX_CCW := FALSE;
    	servoX_CW := TRUE;
    ELSIF vXAxisCmd < xAxis THEN
    	servoX_CCW := TRUE;
    	servoX_CW := FALSE;
    ELSE
    	servoX_CCW := FALSE;
    	servoX_CW := FALSE;
    END_IF
    	
    IF vYAxisCmd < yAxis THEN
    	servoY_CCW := TRUE;
    	servoY_CW := FALSE;
    ELSIF vYAxisCmd > yAxis THEN
    	servoY_CCW := FALSE;
    	servoY_CW := TRUE;
    ELSE
    	servoY_CCW := FALSE;
    	servoY_CW := FALSE;
    END_IF

    	
END_FUNCTION_BLOCK
```

## Metrics  

| VAR_IN | VAR_OUT | VAR_IN_OUT | VAR_LOCAL | VAR_EXTERNAL | VAR_TEMP |
| ------ | ------- | ---------- | --------- | ------------ | -------- |
| 3 | 5 | 0 | 5 | 0 | 0 |

| Actions | Lines of code | Maintainable size |
| ------- | ------------- | ----------------- |
| 0 | 49 | 70 |

---
Autogenerated with [ia_tools](https://github.com/tkucic/ia_tools)  

[MAIN]: ../../../../index_st.md
[NAMESPACES]: ../../nsList_st.md
[METRICS]: ../../../metrics_st.md
[BACK]: ../nsMain_st.md
